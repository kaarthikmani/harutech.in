<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Store | HaruTech</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: #f6f9fc; color: #333; }
    header {
      text-align: center;
      padding: 50px 20px 30px;
      background: linear-gradient(to right, #4a00e0, #8e2de2);
      color: white;
      position: relative;
    }
    header img {
      height: 50px;
      margin-bottom: 10px;
    }
    header h1 {
      font-size: 2.4rem;
      margin: 10px 0 10px;
    }
    .cta-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }
    .cta-buttons a {
      padding: 12px 24px;
      text-align: center;
      border-radius: 6px;
      font-weight: bold;
      color: white;
      text-decoration: none;
      min-width: 120px;
    }
    .cta-buttons a:nth-child(1) { background: #00bcd4; }
    .cta-buttons a:nth-child(2) { background: #e91e63; }
    .cta-buttons a:nth-child(3) { background: #4caf50; }
    #currencySelector {
      position: absolute;
      top: 20px;
      right: 130px;
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      font-size: 0.9rem;
    }
    #cartLink {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      font-weight: bold;
      text-decoration: none;
    }
    h2.section-title {
      text-align: center;
      margin-top: 40px;
      font-size: 1.6rem;
      color: #4a00e0;
    }
    .book-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 40px 20px;
    }
    .book-card {
      flex: 0 1 calc(14.28% - 20px);
      max-width: 160px;
      background: #fff;
      border-radius: 12px;
      padding: 20px 15px;
      text-align: center;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    .book-card img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .book-card h4 {
      font-size: 1rem;
      margin: 5px 0;
      color: #4a00e0;
    }
    .book-card p {
      font-size: 0.85rem;
      color: #555;
    }
    .buy-button {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 16px;
      background-color: #4a00e0;
      color: white;
      text-decoration: none;
      border: none;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
    }
    .buy-button:hover {
      background-color: #3a00b2;
    }
    .info-banner {
      background: #fff3cd;
      padding: 12px;
      text-align: center;
      font-weight: bold;
      color: #856404;
    }
    footer {
      background: #1a1a1a;
      padding: 30px;
      text-align: center;
      font-size: 0.9rem;
      color: #aaa;
    }
    footer a {
      color: #aaa;
      text-decoration: none;
      margin: 0 10px;
    }
    footer a:hover { text-decoration: underline; }
    .filters {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 30px;
    }
    select {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }
    @media (max-width: 1200px) {
      .book-card { flex: 0 1 calc(20% - 20px); }
    }
    @media (max-width: 900px) {
      .book-card { flex: 0 1 calc(33.33% - 20px); }
    }
    @media (max-width: 600px) {
      .book-card { flex: 0 1 calc(50% - 20px); }
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="HaruTech Logo">
    <div>The New Permanent</div>
    <h1>BOOK STORE</h1>
    <div class="cta-buttons">
      <a href="index.html">Home</a>
      <a href="products.html">Softwares</a>
      <a href="store.html">Dresses</a>
    </div>
    <select id="currencySelector" onchange="updateCurrency()">
      <option value="INR">â‚¹ INR</option>
      <option value="USD">$ USD</option>
      <option value="KHR">áŸ› KHR</option>
    </select>
    <a href="cart.html" id="cartLink">ðŸ›’ Cart</a>
  </header>
  <div class="info-banner">
    ðŸ›’ Click the Cart button on the top right to checkout after adding books.
  </div>
  <div class="filters">
    <select id="genreFilter"><option value="">All Genres</option></select>
    <select id="authorFilter"><option value="">All Authors</option></select>
    <select id="languageFilter"><option value="">All Languages</option></select>
  </div>
  <h2 class="section-title">eBooks</h2>
  <section class="book-grid" id="ebooksSection"></section>
  <h2 class="section-title">Paperbacks</h2>
  <section class="book-grid" id="paperbacksSection"></section>
  <footer>
    <div>
      <a href="download.html">Download</a> |
      <a href="vision.html">Vision</a> |
      <a href="contact.html">Contact Us</a> 
    </div>
    <br>
    CEO: Haru Theav Yuki<br>
    &copy; 2025 HaruTech. All rights reserved.
    <div style="text-align: center; margin-top: 15px;">
      <a href="https://info.flagcounter.com/j4Dh">
        <img src="https://s01.flagcounter.com/count2/j4Dh/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="Flag Counter" border="0">
      </a>
    </div>
  </footer>
  <script>
    const exchangeRates = { INR: 1, USD: 0.012, KHR: 50 };
    function updateCurrency() {
      const currency = document.getElementById("currencySelector").value;
      const prices = document.querySelectorAll(".price");
      prices.forEach(p => {
        const base = parseFloat(p.getAttribute("data-price"));
        const converted = base * exchangeRates[currency];
        const symbol = currency === "INR" ? "â‚¹" : currency === "USD" ? "$" : "áŸ›";
        p.innerText = symbol + converted.toFixed(2);
      });
    }
    function addToCart(title, price) {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const existing = cart.find(item => item.title === title);

  if (existing) {
    existing.quantity += 1;
  } else {
    cart.push({ title, price: parseFloat(price), quantity: 1 });

  }

  localStorage.setItem("cart", JSON.stringify(cart));
  alert(`${title} added to cart`);
}

    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTvfkGr1hd4NJK-jylkCAdVx8WDd9jw1aFXU4QSHWExNgAMOLfKAoNZ-93022FBBf_yBOLxEFMm1ffa/pub?gid=0&single=true&output=csv";
    let booksData = [], currentPage = 1, booksPerPage = 30;
    async function fetchBooks() {
      const response = await fetch(sheetURL);
      const data = await response.text();
      const parsed = Papa.parse(data, { header: true }).data;
      booksData = parsed.filter(row => row.ID && row.Title);
      populateFilters();
      applyFilters();
    }
    function populateFilters() {
      const genreSet = new Set(), authorSet = new Set(), langSet = new Set();
      booksData.forEach(book => {
        genreSet.add(book.Genre);
        authorSet.add(book.Author);
        langSet.add(book.Language);
      });
      populateSelect("genreFilter", genreSet);
      populateSelect("authorFilter", authorSet);
      populateSelect("languageFilter", langSet);
    }
    function populateSelect(id, set) {
      const select = document.getElementById(id);
      set.forEach(value => {
        const opt = document.createElement("option");
        opt.value = value;
        opt.textContent = value;
        select.appendChild(opt);
      });
    }
    function applyFilters(page = 1) {
      currentPage = page;
      const genre = document.getElementById("genreFilter").value;
      const author = document.getElementById("authorFilter").value;
      const language = document.getElementById("languageFilter").value;
      const ebooksSection = document.getElementById("ebooksSection");
      const paperbacksSection = document.getElementById("paperbacksSection");
      ebooksSection.innerHTML = "";
      paperbacksSection.innerHTML = "";
      const filtered = booksData.filter(b =>
        (!genre || b.Genre === genre) &&
        (!author || b.Author === author) &&
        (!language || b.Language === language)
      );
      const start = (currentPage - 1) * booksPerPage;
      const end = start + booksPerPage;
      const paginated = filtered.slice(start, end);
      paginated.forEach(row => {
        const { ID: id, Title: title, Author: author, Price: price, ImageURL: imageURL, Type: type, BuyURL: buyURL } = row;
        const cardHTML = `
          <div class="book-card" data-id="${id}">
            <img src="${imageURL}" alt="${title}">
            <h4>${title}</h4>
            <p><strong>Author:</strong> ${author}</p>
            <p class="price" data-price="${price}">â‚¹${price}</p>
            ${buyURL?.trim()
              ? `<a href="${buyURL}" class="buy-button" target="_blank">Read Now</a>`
              : `<button class="buy-button" onclick="addToCart('${title}', ${price})">Add to Cart</button>`}
          </div>
        `;
        if (type.toLowerCase() === "ebook") ebooksSection.innerHTML += cardHTML;
        else if (type.toLowerCase() === "paperback") paperbacksSection.innerHTML += cardHTML;
      });
      updateCurrency();
      renderPagination(filtered.length);
    }
    function renderPagination(totalBooks) {
      let totalPages = Math.ceil(totalBooks / booksPerPage);
      let paginationHTML = "";
      if (totalPages <= 1) return;
      paginationHTML += `<div style="text-align:center; margin-bottom:30px;">`;
      if (currentPage > 1)
        paginationHTML += `<button onclick="applyFilters(${currentPage - 1})">Â« Prev</button> `;
      for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `<button onclick="applyFilters(${i})" style="margin:0 4px;${i === currentPage ? 'font-weight:bold;' : ''}">${i}</button>`;
      }
      if (currentPage < totalPages)
        paginationHTML += ` <button onclick="applyFilters(${currentPage + 1})">Next Â»</button>`;
      paginationHTML += `</div>`;
      document.getElementById("ebooksSection").insertAdjacentHTML("beforebegin", paginationHTML);
    }
    document.getElementById("genreFilter").addEventListener("change", () => applyFilters(1));
    document.getElementById("authorFilter").addEventListener("change", () => applyFilters(1));
    document.getElementById("languageFilter").addEventListener("change", () => applyFilters(1));
    fetchBooks();
  </script>
</body>
</html>
