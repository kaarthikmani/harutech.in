<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Store | HaruTech</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* (existing styles remain untouched) */
    .pagination {
      text-align: center;
      margin: 20px 0;
    }
    .pagination button {
      padding: 8px 12px;
      margin: 0 5px;
      border: none;
      background-color: #4a00e0;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .pagination button.active {
      background-color: #6a1de2;
    }
    .pagination button:disabled {
      background-color: #ccc;
      cursor: default;
    }
  </style>
</head>
<body>
<!-- (existing body remains untouched until footer) -->

  <div class="pagination" id="pagination"></div>

  <footer>
    <div>
      <a href="download.html">Download</a> |
      <a href="vision.html">Vision</a> |
      <a href="contact.html">Contact Us</a> 
    </div>
    <br>
    CEO: Haru Theav Yuki<br>
    &copy; 2025 HaruTech. All rights reserved.
    <div style="text-align: center; margin-top: 15px;">
      <a href="https://info.flagcounter.com/j4Dh">
        <img src="https://s01.flagcounter.com/count2/j4Dh/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="Flag Counter" border="0">
      </a>
    </div>
  </footer>

  <script>
    const exchangeRates = { INR: 1, USD: 0.012, KHR: 50 };

    function updateCurrency() {
      const currency = document.getElementById("currencySelector").value;
      const prices = document.querySelectorAll(".price");

      prices.forEach(p => {
        const base = parseFloat(p.getAttribute("data-price"));
        const converted = base * exchangeRates[currency];
        const symbol = currency === "INR" ? "₹" : currency === "USD" ? "$" : "៛";
        p.innerText = symbol + converted.toFixed(2);
      });
    }

    function addToCart(title, price) {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart.push({ title, price });
      localStorage.setItem("cart", JSON.stringify(cart));
      alert(`${title} added to cart`);
    }

    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTvfkGr1hd4NJK-jylkCAdVx8WDd9jw1aFXU4QSHWExNgAMOLfKAoNZ-93022FBBf_yBOLxEFMm1ffa/pub?gid=0&single=true&output=csv&t=" + new Date().getTime();
    let booksData = [];
    let currentPage = 1;
    const booksPerPage = 30;

    async function fetchBooks() {
      const response = await fetch(sheetURL);
      const data = await response.text();
      const parsed = Papa.parse(data, { header: true }).data;

      booksData = parsed.filter(row => row.ID && row.Title);
      populateFilters();
      applyFilters();
    }

    function populateFilters() {
      const genreSet = new Set();
      const authorSet = new Set();
      const langSet = new Set();

      booksData.forEach(book => {
        genreSet.add(book.Genre);
        authorSet.add(book.Author);
        langSet.add(book.Language);
      });

      populateSelect("genreFilter", genreSet);
      populateSelect("authorFilter", authorSet);
      populateSelect("languageFilter", langSet);
    }

    function populateSelect(id, set) {
      const select = document.getElementById(id);
      set.forEach(value => {
        const opt = document.createElement("option");
        opt.value = value;
        opt.textContent = value;
        select.appendChild(opt);
      });
    }

    function applyFilters() {
      const genre = document.getElementById("genreFilter").value;
      const author = document.getElementById("authorFilter").value;
      const language = document.getElementById("languageFilter").value;

      const filtered = booksData.filter(b =>
        (!genre || b.Genre === genre) &&
        (!author || b.Author === author) &&
        (!language || b.Language === language)
      );

      renderBooks(filtered, currentPage);
      renderPagination(filtered);
    }

    function renderBooks(data, page) {
      const ebooksSection = document.getElementById("ebooksSection");
      const paperbacksSection = document.getElementById("paperbacksSection");
      ebooksSection.innerHTML = "";
      paperbacksSection.innerHTML = "";

      const start = (page - 1) * booksPerPage;
      const end = start + booksPerPage;
      const paginatedData = data.slice(start, end);

      paginatedData.forEach(row => {
        const { ID: id, Title: title, Author: author, Price: price, ImageURL: imageURL, Type: type, BuyURL: buyURL } = row;

        const cardHTML = `
          <div class="book-card" data-id="${id}">
            <img src="${imageURL}" alt="${title}">
            <h4>${title}</h4>
            <p><strong>Author:</strong> ${author}</p>
            <p class="price" data-price="${price}">₹${price}</p>
            ${buyURL?.trim()
              ? `<a href="${buyURL}" class="buy-button" target="_blank">Read Now</a>`
              : `<button class="buy-button" onclick="addToCart('${title}', ${price})">Add to Cart</button>`}
          </div>
        `;

        if (type.toLowerCase() === "ebook") {
          ebooksSection.innerHTML += cardHTML;
        } else if (type.toLowerCase() === "paperback") {
          paperbacksSection.innerHTML += cardHTML;
        }
      });

      updateCurrency();
    }

    function renderPagination(data) {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
      const totalPages = Math.ceil(data.length / booksPerPage);

      const prevBtn = document.createElement("button");
      prevBtn.textContent = "Prev";
      prevBtn.disabled = currentPage === 1;
      prevBtn.onclick = () => { currentPage--; applyFilters(); };
      pagination.appendChild(prevBtn);

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = i === currentPage ? "active" : "";
        btn.onclick = () => { currentPage = i; applyFilters(); };
        pagination.appendChild(btn);
      }

      const nextBtn = document.createElement("button");
      nextBtn.textContent = "Next";
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.onclick = () => { currentPage++; applyFilters(); };
      pagination.appendChild(nextBtn);
    }

    document.getElementById("genreFilter").addEventListener("change", () => { currentPage = 1; applyFilters(); });
    document.getElementById("authorFilter").addEventListener("change", () => { currentPage = 1; applyFilters(); });
    document.getElementById("languageFilter").addEventListener("change", () => { currentPage = 1; applyFilters(); });

    window.onload = fetchBooks;
  </script>
</body>
</html>
